import{s as A,a as G,S as N}from"./chunk-TVAH2DTR.js";import{_ as u,c as t,d as M,l as S,e as W,k as z,R as P,S as U,O as C,u as D}from"./index.js";import{G as F}from"./graph.js";import{l as I}from"./layout.js";import"./chunk-55IACEB6.js";import"./chunk-QN33PNHL.js";import"./XCircleIcon.js";import"./_baseUniq.js";import"./_basePickBy.js";(function(){try{var e=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{};e.SENTRY_RELEASE={id:"a7250bca359ed53df7b9c1355cb914c80ea7240b"}}catch{}})();try{(function(){var e=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{},a=new e.Error().stack;a&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[a]="cd671491-8716-452f-8f49-33a04e240ad5",e._sentryDebugIdIdentifier="sentry-dbid-cd671491-8716-452f-8f49-33a04e240ad5")})()}catch{}var O=u(e=>e.append("circle").attr("class","start-state").attr("r",t().state.sizeUnit).attr("cx",t().state.padding+t().state.sizeUnit).attr("cy",t().state.padding+t().state.sizeUnit),"drawStartState"),J=u(e=>e.append("line").style("stroke","grey").style("stroke-dasharray","3").attr("x1",t().state.textHeight).attr("class","divider").attr("x2",t().state.textHeight*2).attr("y1",0).attr("y2",0),"drawDivider"),X=u((e,a)=>{const s=e.append("text").attr("x",2*t().state.padding).attr("y",t().state.textHeight+2*t().state.padding).attr("font-size",t().state.fontSize).attr("class","state-title").text(a.id),c=s.node().getBBox();return e.insert("rect",":first-child").attr("x",t().state.padding).attr("y",t().state.padding).attr("width",c.width+2*t().state.padding).attr("height",c.height+2*t().state.padding).attr("rx",t().state.radius),s},"drawSimpleState"),Y=u((e,a)=>{const s=u(function(l,m,b){const v=l.append("tspan").attr("x",2*t().state.padding).text(m);b||v.attr("dy",t().state.textHeight)},"addTspan"),r=e.append("text").attr("x",2*t().state.padding).attr("y",t().state.textHeight+1.3*t().state.padding).attr("font-size",t().state.fontSize).attr("class","state-title").text(a.descriptions[0]).node().getBBox(),g=r.height,f=e.append("text").attr("x",t().state.padding).attr("y",g+t().state.padding*.4+t().state.dividerMargin+t().state.textHeight).attr("class","state-description");let i=!0,d=!0;a.descriptions.forEach(function(l){i||(s(f,l,d),d=!1),i=!1});const w=e.append("line").attr("x1",t().state.padding).attr("y1",t().state.padding+g+t().state.dividerMargin/2).attr("y2",t().state.padding+g+t().state.dividerMargin/2).attr("class","descr-divider"),p=f.node().getBBox(),o=Math.max(p.width,r.width);return w.attr("x2",o+3*t().state.padding),e.insert("rect",":first-child").attr("x",t().state.padding).attr("y",t().state.padding).attr("width",o+2*t().state.padding).attr("height",p.height+g+2*t().state.padding).attr("rx",t().state.radius),e},"drawDescrState"),$=u((e,a,s)=>{const c=t().state.padding,r=2*t().state.padding,g=e.node().getBBox(),f=g.width,i=g.x,d=e.append("text").attr("x",0).attr("y",t().state.titleShift).attr("font-size",t().state.fontSize).attr("class","state-title").text(a.id),p=d.node().getBBox().width+r;let o=Math.max(p,f);o===f&&(o=o+r);let l;const m=e.node().getBBox();a.doc,l=i-c,p>f&&(l=(f-o)/2+c),Math.abs(i-m.x)<c&&p>f&&(l=i-(p-f)/2);const b=1-t().state.textHeight;return e.insert("rect",":first-child").attr("x",l).attr("y",b).attr("class",s?"alt-composit":"composit").attr("width",o).attr("height",m.height+t().state.textHeight+t().state.titleShift+1).attr("rx","0"),d.attr("x",l+c),p<=f&&d.attr("x",i+(o-r)/2-p/2+c),e.insert("rect",":first-child").attr("x",l).attr("y",t().state.titleShift-t().state.textHeight-t().state.padding).attr("width",o).attr("height",t().state.textHeight*3).attr("rx",t().state.radius),e.insert("rect",":first-child").attr("x",l).attr("y",t().state.titleShift-t().state.textHeight-t().state.padding).attr("width",o).attr("height",m.height+3+2*t().state.textHeight).attr("rx",t().state.radius),e},"addTitleAndBox"),q=u(e=>(e.append("circle").attr("class","end-state-outer").attr("r",t().state.sizeUnit+t().state.miniPadding).attr("cx",t().state.padding+t().state.sizeUnit+t().state.miniPadding).attr("cy",t().state.padding+t().state.sizeUnit+t().state.miniPadding),e.append("circle").attr("class","end-state-inner").attr("r",t().state.sizeUnit).attr("cx",t().state.padding+t().state.sizeUnit+2).attr("cy",t().state.padding+t().state.sizeUnit+2)),"drawEndState"),Z=u((e,a)=>{let s=t().state.forkWidth,c=t().state.forkHeight;if(a.parentId){let r=s;s=c,c=r}return e.append("rect").style("stroke","black").style("fill","black").attr("width",s).attr("height",c).attr("x",t().state.padding).attr("y",t().state.padding)},"drawForkJoinState"),j=u((e,a,s,c)=>{let r=0;const g=c.append("text");g.style("text-anchor","start"),g.attr("class","noteText");let f=e.replace(/\r\n/g,"<br/>");f=f.replace(/\n/g,"<br/>");const i=f.split(z.lineBreakRegex);let d=1.25*t().state.noteMargin;for(const w of i){const p=w.trim();if(p.length>0){const o=g.append("tspan");if(o.text(p),d===0){const l=o.node().getBBox();d+=l.height}r+=d,o.attr("x",a+t().state.noteMargin),o.attr("y",s+r+1.25*t().state.noteMargin)}}return{textWidth:g.node().getBBox().width,textHeight:r}},"_drawLongText"),K=u((e,a)=>{a.attr("class","state-note");const s=a.append("rect").attr("x",0).attr("y",t().state.padding),c=a.append("g"),{textWidth:r,textHeight:g}=j(e,0,0,c);return s.attr("height",g+2*t().state.noteMargin),s.attr("width",r+t().state.noteMargin*2),s},"drawNote"),L=u(function(e,a){const s=a.id,c={id:s,label:a.id,width:0,height:0},r=e.append("g").attr("id",s).attr("class","stateGroup");a.type==="start"&&O(r),a.type==="end"&&q(r),(a.type==="fork"||a.type==="join")&&Z(r,a),a.type==="note"&&K(a.note.text,r),a.type==="divider"&&J(r),a.type==="default"&&a.descriptions.length===0&&X(r,a),a.type==="default"&&a.descriptions.length>0&&Y(r,a);const g=r.node().getBBox();return c.width=g.width+2*t().state.padding,c.height=g.height+2*t().state.padding,c},"drawState"),_=0,Q=u(function(e,a,s){const c=u(function(d){switch(d){case N.relationType.AGGREGATION:return"aggregation";case N.relationType.EXTENSION:return"extension";case N.relationType.COMPOSITION:return"composition";case N.relationType.DEPENDENCY:return"dependency"}},"getRelationType");a.points=a.points.filter(d=>!Number.isNaN(d.y));const r=a.points,g=P().x(function(d){return d.x}).y(function(d){return d.y}).curve(U),f=e.append("path").attr("d",g(r)).attr("id","edge"+_).attr("class","transition");let i="";if(t().state.arrowMarkerAbsolute&&(i=C(!0)),f.attr("marker-end","url("+i+"#"+c(N.relationType.DEPENDENCY)+"End)"),s.title!==void 0){const d=e.append("g").attr("class","stateLabel"),{x:w,y:p}=D.calcLabelPosition(a.points),o=z.getRows(s.title);let l=0;const m=[];let b=0,v=0;for(let x=0;x<=o.length;x++){const h=d.append("text").attr("text-anchor","middle").text(o[x]).attr("x",w).attr("y",p+l),y=h.node().getBBox();b=Math.max(b,y.width),v=Math.min(v,y.x),S.info(y.x,w,p+l),l===0&&(l=h.node().getBBox().height,S.info("Title height",l,p)),m.push(h)}let k=l*o.length;if(o.length>1){const x=(o.length-1)*l*.5;m.forEach((h,y)=>h.attr("y",p+y*l-x)),k=l*o.length}const n=d.node().getBBox();d.insert("rect",":first-child").attr("class","box").attr("x",w-b/2-t().state.padding/2).attr("y",p-k/2-t().state.padding/2-3.5).attr("width",b+t().state.padding).attr("height",k+t().state.padding),S.info(n)}_++},"drawEdge"),B,H={},V=u(function(){},"setConf"),tt=u(function(e){e.append("defs").append("marker").attr("id","dependencyEnd").attr("refX",19).attr("refY",7).attr("markerWidth",20).attr("markerHeight",28).attr("orient","auto").append("path").attr("d","M 19,7 L9,13 L14,7 L9,1 Z")},"insertMarkers"),et=u(function(e,a,s,c){B=t().state;const r=t().securityLevel;let g;r==="sandbox"&&(g=M("#i"+a));const f=r==="sandbox"?M(g.nodes()[0].contentDocument.body):M("body"),i=r==="sandbox"?g.nodes()[0].contentDocument:document;S.debug("Rendering diagram "+e);const d=f.select(`[id='${a}']`);tt(d);const w=c.db.getRootDoc();R(w,d,void 0,!1,f,i,c);const p=B.padding,o=d.node().getBBox(),l=o.width+p*2,m=o.height+p*2,b=l*1.75;W(d,m,b,B.useMaxWidth),d.attr("viewBox",`${o.x-B.padding}  ${o.y-B.padding} `+l+" "+m)},"draw"),at=u(e=>e?e.length*B.fontSizeFactor:1,"getLabelWidth"),R=u((e,a,s,c,r,g,f)=>{const i=new F({compound:!0,multigraph:!0});let d,w=!0;for(d=0;d<e.length;d++)if(e[d].stmt==="relation"){w=!1;break}s?i.setGraph({rankdir:"LR",multigraph:!0,compound:!0,ranker:"tight-tree",ranksep:w?1:B.edgeLengthFactor,nodeSep:w?1:50,isMultiGraph:!0}):i.setGraph({rankdir:"TB",multigraph:!0,compound:!0,ranksep:w?1:B.edgeLengthFactor,nodeSep:w?1:50,ranker:"tight-tree",isMultiGraph:!0}),i.setDefaultEdgeLabel(function(){return{}});const p=f.db.getStates(),o=f.db.getRelations(),l=Object.keys(p);for(const n of l){const x=p[n];s&&(x.parentId=s);let h;if(x.doc){let y=a.append("g").attr("id",x.id).attr("class","stateGroup");h=R(x.doc,y,x.id,!c,r,g,f);{y=$(y,x,c);let E=y.node().getBBox();h.width=E.width,h.height=E.height+B.padding/2,H[x.id]={y:B.compositTitleSize}}}else h=L(a,x,i);if(x.note){const y={descriptions:[],id:x.id+"-note",note:x.note,type:"note"},E=L(a,y,i);x.note.position==="left of"?(i.setNode(h.id+"-note",E),i.setNode(h.id,h)):(i.setNode(h.id,h),i.setNode(h.id+"-note",E)),i.setParent(h.id,h.id+"-group"),i.setParent(h.id+"-note",h.id+"-group")}else i.setNode(h.id,h)}S.debug("Count=",i.nodeCount(),i);let m=0;o.forEach(function(n){m++,S.debug("Setting edge",n),i.setEdge(n.id1,n.id2,{relation:n,width:at(n.title),height:B.labelHeight*z.getRows(n.title).length,labelpos:"c"},"id"+m)}),I(i),S.debug("Graph after layout",i.nodes());const b=a.node();i.nodes().forEach(function(n){n!==void 0&&i.node(n)!==void 0?(S.warn("Node "+n+": "+JSON.stringify(i.node(n))),r.select("#"+b.id+" #"+n).attr("transform","translate("+(i.node(n).x-i.node(n).width/2)+","+(i.node(n).y+(H[n]?H[n].y:0)-i.node(n).height/2)+" )"),r.select("#"+b.id+" #"+n).attr("data-x-shift",i.node(n).x-i.node(n).width/2),g.querySelectorAll("#"+b.id+" #"+n+" .divider").forEach(h=>{const y=h.parentElement;let E=0,T=0;y&&(y.parentElement&&(E=y.parentElement.getBBox().width),T=parseInt(y.getAttribute("data-x-shift"),10),Number.isNaN(T)&&(T=0)),h.setAttribute("x1",0-T+8),h.setAttribute("x2",E-T-8)})):S.debug("No Node "+n+": "+JSON.stringify(i.node(n)))});let v=b.getBBox();i.edges().forEach(function(n){n!==void 0&&i.edge(n)!==void 0&&(S.debug("Edge "+n.v+" -> "+n.w+": "+JSON.stringify(i.edge(n))),Q(a,i.edge(n),i.edge(n).relation))}),v=b.getBBox();const k={id:s||"root",label:s||"root",width:0,height:0};return k.width=v.width+2*B.padding,k.height=v.height+2*B.padding,S.debug("Doc rendered",k,i),k},"renderDoc"),it={setConf:V,draw:et},pt={parser:G,get db(){return new N(1)},renderer:it,styles:A,init:u(e=>{e.state||(e.state={}),e.state.arrowMarkerAbsolute=e.arrowMarkerAbsolute},"init")};export{pt as diagram};
//# sourceMappingURL=stateDiagram-KXAO66HF.js.map
